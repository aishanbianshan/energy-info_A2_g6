\documentclass[a4paper, article, oneside, USenglish, IN5460]{memoir}

\input{style/import}

\newlength\figH
\newlength\figW
\setlength{\figH}{8cm}
\setlength{\figW}{12cm}


\DeclareMathOperator*{\min}{\text{\Large minimize}}

\usepackage{optidef}
\usepackage{listings} 


\title{ Wind Energy Forecasting }
\authors{W. Cai, F. Ofstad, E. F. RÃ¸rstad}

\addbibresource{bibliography.bib}

\begin{document}

\shorthandoff{}

\projectfrontpage


\chapter{Introduction}
\subsection{linear regression for wind power prediction}
the linear model is defined as $y=wx+b$.
And the residual for observation $i$ is $e_i =y_i -(wx_i+b)$. Thus, linear regression is used to minimize the sum of residual squares, shown as followed:
\begin{equation}
\begin{aligned}
\min_{w,b}\sum_{i=1}^{n} [y_i-(wx_i+b)]^2
\end{aligned}
\end{equation}
\newline


\subsection{K-NN for wind power prediction}
\begin{equation}
\begin{aligned}

\end{aligned}
\end{equation}
\newline

\subsection{SVR for wind power prediction}
\begin{equation}
\begin{aligned}

\end{aligned}
\end{equation}
\newline


\subsection{ANN for wind power prediction}
Each single artificial neuron is defined as the following: 
\begin{equation}
\begin{aligned}
y(x) = f(\sum_{i=1}^{n} w_i*x_i)
\end{aligned}
\end{equation}
where $y(x)$ is the variable for output signal, $x_i$ are variables for input signals, $w_i$ are the weights of corresponding input signals. $f()$ is the activation function of each node. Hidden layers with hidden nodes in between of inputs and the output forms a neutral network topology
\newline

\subsection{RNN  for wind power prediction}
\begin{equation}
\begin{aligned}

\end{aligned}
\end{equation}
\newline

\chapter{Question 1}


\chapter{Question 2}
% You can calculate the wind direction based on the zonal component and meridional component.
% what formula???

\chapter{Question 3}

LR

SVR

ANN

RNN

-Time series doesn't necessarily provide a linear relationship, make LR not as accurate?

- RNN with its "memory", is the obvious choice for forecasting based on time series.

\begin{table}[H]
\begin{tabular}{|l|l|l|l|l|}
\hline
Method & LR & SVR & ANN & RNN \\ \hline
RMSE   & 0  & 0   & 0   & 0   \\ \hline
\end{tabular}
\end{table}


\chapter{Question 4}

\begin{figure}
\centering
\includegraphics[width=0.8\linewidth]{fig/q4.png}
\caption{\label{fig:q4} \neutral network topology}
\end{figure}
{
Given $x_1 = 0.04, x_2 = 0.2, y_1 =0.5,  \alpha = 0.4$, sigmoid activation functions
\newline
\textbf{Initial guess of weights:}
$w_1 = 0.12; 
w_2 = 0.2;
w_3 = 0.11;
w_4 = 0.25;
w_5 = 0.21;
w_6 = 0.3.$ 
% USE PYTHON SHELL TO CALCULATE!!
\newline
\textbf{ Forward: }
$\newline\text{sum}h_1 = w_1*x_1 + w_2*x_2 = 0.044800000000000006 
\newline\text{out}h_1 =sigmoid (\text{sum}h_1) =0.5111981271385566
\newline\text{sum}h_2 = w_3*x_1 + w_4*x_2 =0.054400000000000004
\newline\text{out}h_2 =sigmoid (\text{sum}h_2) =0.5135966470509216
\newline\text{sum}y_1 = w_5*\text{out}h_1 + w_6*\text{out}h_2 = 0.2614306008143733 
\newline\text{out}y_1 =sigmoid (\text{sum}y_1) = 0.5649879325949473$


\newline
\textbf{Error :}

\begin{equation}
\begin{aligned}
\text{E}_{total} &= 
\frac{1}{2}\sum(y_1 -\text{out}y_1)^2 = 0.2549273084527181
\end{aligned}
\end{equation}

\begin{equation}
\begin{aligned}
\text{E'}_{total}&= \frac{1}{2}*2*(y_1 - \text{out}y_1)*(-1)= 0.06498793259494728
\end{aligned}
\end{equation}

\newline Because $\text{E'}_{total} >0 $, we use gradient descent to update $w_1 \ldots w_6 $



\newline
\textbf{Updating weights :}

for $w_6$ :
\begin{equation}
\begin{aligned}
\frac{\partial \text{E}_{total}  }{\partial w_6} &= 
\frac{\partial \text{E}_{total}}{\partial \text{out}y_1} *\frac{\partial  \text{out}y_1}{\partial \text{sum}y_1}*\frac{\partial \text{sum}y_1}{\partial  w_6}\\
&= [2*\frac{1}{2}*(y_1 -\text{out}y_1)*(-1)] * [\text{out}y_1(1-\text{out}y_1)] *\text{out}h_2 \\
& =0.00820342813295029
\end{aligned}
\end{equation}


\begin{equation}
\begin{aligned}
w^+_6 &= w_6 - \alpha * \frac{\partial \text{E}_{total}  }{\partial w_6} \\
& =  0.29671862874681987
\end{aligned}
\end{equation}


\newline
for $w_5$ :
\begin{equation}
\begin{aligned}
\frac{\partial \text{E}_{total}  }{\partial w_5} &= \frac{\partial \text{E}_{total}}{\partial \text{out}y_1} *\frac{\partial  \text{out}y_1}{\partial \text{sum}y_1}*\frac{\partial \text{sum}y_1}{\partial  w_5}\\
&=[2*\frac{1}{2}*(y_1 -\text{out}y_1)*(-1)] * [\text{out}y_1(1-\text{out}y_1)] *\text{out}h_1 \\
& = 0.008165117747087149

\end{aligned}
\end{equation}
\begin{equation}
\begin{aligned}
w^+_5 &= w_5 - \alpha * \frac{\partial \text{E}_{total}  }{\partial w_5} \\
& = 0.20673395290116514
\end{aligned}
\end{equation}


\newline
for $w_4$ :
\begin{equation}
\begin{aligned}
\frac{\partial \text{E}_{total}  }{\partial w_4} &= \frac{\partial \text{E}_{total}}{\partial \text{out}y_1} *\frac{\partial  \text{out}y_1}{\partial \text{sum}y_1}*\frac{\partial \text{sum}y_1}{\partial  w_4} \\
&= \frac{\partial \text{E}_{total}}{\partial \text{out}y_1} *\frac{\partial  \text{out}y_1}{\partial \text{sum}y_1}*\frac{\partial ( w_5*\text{out}h_1 + w_6*\text{out}h_2 )} {\partial w_4} \\
&= \frac{\partial \text{E}_{total}}{\partial \text{out}y_1} * \frac{\partial \text{out}y_1}{\partial \text{sum}y_1} *{w_6}* \frac{\partial ( \text{out}h_2 )} {\partial w_4}\\
&= \frac{\partial \text{E}_{total}}{\partial \text{out}y_1} * \frac{\partial \text{out}y_1}{\partial \text{sum}y_1} *{w_6}* \frac{\partial ( \text{out}h_2 )}{\partial \text{sum}h_2} * \frac{\partial ( \text{sum}h_2)}{\partial w_4}\\
&= \frac{\partial \text{E}_{total}}{\partial \text{out}y_1} * \frac{\partial \text{out}y_1}{\partial \text{sum}y_1} *{w_6}* \frac{\partial ( \text{out}h_2 )}{\partial \text{sum}h_2} * \frac{\partial ( w_3*x_1 + w_4*x_2)}{\partial w_4}\\
&= \frac{\partial \text{E}_{total}}{\partial \text{out}y_1} * \frac{\partial \text{out}y_1}{\partial \text{sum}y_1} *{w_6}* \frac{\partial ( \text{out}h_2 )}{\partial \text{sum}h_2} *  {x_2}\\
&= [2*\frac{1}{2}*(y_1 -\text{out}y_1)*(-1)] * [\text{out}y_1(1-\text{out}y_1)] *{w_6}* [\text{out}h_2 (1-\text{out}h_2)]*  {x_2}\\
& = 0.0002394104969726292
% USE PYTHON SHELL TO CALCULATE!!
% &=[\text{out}y_1 - y_1]*[\text{out}y_1(1-\text{out}y_1)] *{w_6}* [\text{out}h_2 (1-\text{out}h_2)]*  {x_2}\\
% &=[0.5650541-0.5]*[0.5650541(1-0.5650541)]*0.3*[0.5144959(1-0.5144959)]*0.2
 \end{aligned}
\end{equation}
\begin{equation}
\begin{aligned}
w^+_4 &= w_4 - \alpha * \frac{\partial \text{E}_{total}  }{\partial w_4} \\
& = 0.24990423580121096 
\end{aligned}
\end{equation}

\newline
for $w_3$ :
\begin{equation}
\begin{aligned}
\frac{\partial \text{E}_{total}  }{\partial w_3} &= \frac{\partial \text{E}_{total}}{\partial \text{out}y_1} *\frac{\partial  \text{out}y_1}{\partial \text{sum}y_1}*\frac{\partial \text{sum}y_1}{\partial  w_3} \\
&= \frac{\partial \text{E}_{total}}{\partial \text{out}y_1} *\frac{\partial  \text{out}y_1}{\partial \text{sum}y_1}*\frac{\partial ( w_5*\text{out}h_1 + w_6*\text{out}h_2 )} {\partial w_3} \\
&= \frac{\partial \text{E}_{total}}{\partial \text{out}y_1} * \frac{\partial \text{out}y_1}{\partial \text{sum}y_1} *{w_6}* \frac{\partial ( \text{out}h_2 )} {\partial w_3}\\
&= \frac{\partial \text{E}_{total}}{\partial \text{out}y_1} * \frac{\partial \text{out}y_1}{\partial \text{sum}y_1} *{w_6}* \frac{\partial ( \text{out}h_2 )}{\partial \text{sum}h_2} * \frac{\partial ( \text{sum}h_2)}{\partial w_3}\\
&= \frac{\partial \text{E}_{total}}{\partial \text{out}y_1} * \frac{\partial \text{out}y_1}{\partial \text{sum}y_1} *{w_6}* \frac{\partial ( \text{out}h_2 )}{\partial \text{sum}h_2} * \frac{\partial ( w_3*x_1 + w_4*x_2)}{\partial w_3}\\
&= \frac{\partial \text{E}_{total}}{\partial \text{out}y_1} * \frac{\partial \text{out}y_1}{\partial \text{sum}y_1} *{w_6}* \frac{\partial ( \text{out}h_2 )}{\partial \text{sum}h_2} *  {x_1}\\
&= [2*\frac{1}{2}*(y_1 -\text{out}y_1)*(-1)] * [\text{out}y_1(1-\text{out}y_1)] *{w_6}* [\text{out}h_2 (1-\text{out}h_2)]*  {x_1}\\
& = 4.788209939452583(e-05)
\end{aligned}
\end{equation}
\begin{equation}
\begin{aligned}
w^+_3 &= w_3 - \alpha * \frac{\partial \text{E}_{total}  }{\partial w_3} \\
& = 0.10998084716024219
\end{aligned}
\end{equation}

\newline
for $w_2$ :
\begin{equation}
\begin{aligned}
\frac{\partial \text{E}_{total}  }{\partial w_2} &= \frac{\partial \text{E}_{total}}{\partial \text{out}y_1} *\frac{\partial  \text{out}y_1}{\partial \text{sum}y_1}*\frac{\partial \text{sum}y_1}{\partial  w_2} \\
&= \frac{\partial \text{E}_{total}}{\partial \text{out}y_1} *\frac{\partial  \text{out}y_1}{\partial \text{sum}y_1}*\frac{\partial ( w_5*\text{out}h_1 + w_6*\text{out}h_2 )} {\partial w_2} \\
&= \frac{\partial \text{E}_{total}}{\partial \text{out}y_1} * \frac{\partial \text{out}y_1}{\partial \text{sum}y_1} *{w_5}* \frac{\partial ( \text{out}h_1 )} {\partial w_2}\\
&= \frac{\partial \text{E}_{total}}{\partial \text{out}y_1} * \frac{\partial \text{out}y_1}{\partial \text{sum}y_1} *{w_5}* \frac{\partial ( \text{out}h_1 )}{\partial \text{sum}h_1} * \frac{\partial ( \text{sum}h_1)}{\partial w_2}\\
&= \frac{\partial \text{E}_{total}}{\partial \text{out}y_1} * \frac{\partial \text{out}y_1}{\partial \text{sum}y_1} *{w_5}* \frac{\partial ( \text{out}h_1 )}{\partial \text{sum}h_1} * \frac{\partial ( w_1*x_1 + w_2*x_2)}{\partial w_2}\\
&= \frac{\partial \text{E}_{total}}{\partial \text{out}y_1} * \frac{\partial \text{out}y_1}{\partial \text{sum}y_1} *{w_5}* \frac{\partial ( \text{out}h_1 )}{\partial \text{sum}h_1} *  {x_2}\\
&= [2*\frac{1}{2}*(y_1 -\text{out}y_1)*(-1)] * [\text{out}y_1(1-\text{out}y_1)] *{w_5}* [\text{out}h_1 (1-\text{out}h_1)]*  {x_2}\\
& =  0.0001676272435702371
\end{aligned}
\end{equation}
\begin{equation}
\begin{aligned}
w^+_2 &= w_2 - \alpha * \frac{\partial \text{E}_{total}  }{\partial w_2} \\
& = 0.19993294910257192
\end{aligned}
\end{equation}


\newline
for $w_1$ :
\begin{equation}
\begin{aligned}
\frac{\partial \text{E}_{total}  }{\partial w_1} &= \frac{\partial \text{E}_{total}}{\partial \text{out}y_1} *\frac{\partial  \text{out}y_1}{\partial \text{sum}y_1}*\frac{\partial \text{sum}y_1}{\partial  w_1} \\
&= \frac{\partial \text{E}_{total}}{\partial \text{out}y_1} *\frac{\partial  \text{out}y_1}{\partial \text{sum}y_1}*\frac{\partial ( w_5*\text{out}h_1 + w_6*\text{out}h_2 )} {\partial w_1} \\
&= \frac{\partial \text{E}_{total}}{\partial \text{out}y_1} * \frac{\partial \text{out}y_1}{\partial \text{sum}y_1} *{w_5}* \frac{\partial ( \text{out}h_1 )} {\partial w_1}\\
&= \frac{\partial \text{E}_{total}}{\partial \text{out}y_1} * \frac{\partial \text{out}y_1}{\partial \text{sum}y_1} *{w_5}* \frac{\partial ( \text{out}h_1 )}{\partial \text{sum}h_1} * \frac{\partial ( \text{sum}h_1)}{\partial w_1}\\
&= \frac{\partial \text{E}_{total}}{\partial \text{out}y_1} * \frac{\partial \text{out}y_1}{\partial \text{sum}y_1} *{w_5}* \frac{\partial ( \text{out}h_1 )}{\partial \text{sum}h_1} * \frac{\partial ( w_1*x_1 + w_2*x_2)}{\partial w_1}\\
&= \frac{\partial \text{E}_{total}}{\partial \text{out}y_1} * \frac{\partial \text{out}y_1}{\partial \text{sum}y_1} *{w_5}* \frac{\partial ( \text{out}h_1 )}{\partial \text{sum}h_1} *  {x_1}\\
&= [2*\frac{1}{2}*(y_1 -\text{out}y_1)*(-1)] * [\text{out}y_1(1-\text{out}y_1)] *{w_5}* [\text{out}h_1 (1-\text{out}h_1)]*  {x_1}\\
& = 3.352544871404742(e-05)
\end{aligned}
\end{equation}
\begin{equation}
\begin{aligned}
w^+_1 &= w_1 - \alpha * \frac{\partial \text{E}_{total}  }{\partial w_1} \\
& = 0.11998658982051438
\end{aligned}
\end{equation}

\newline
We set $d= 0.0001$ as the threshold for the difference between the error in a round and the error in the previous round.  Our training program gives out the finalized model with updated weights and RMSE:
\newline
$
\newline w_1=0.11958332140900257, \newline w_2=0.1979166070450119, \newline w_3=0.10913999266241521, \newline w_4=0.24569996331207614, \newline w_5=-0.04364773356669475, \newline w_6=0.045190414766981955, \newline \text{RMSE}=0.015029038262485394
$


\begin{table}[htbp] % Place the table here, at the top, bottom, or on a separate page (h: here, t: top, b: bottom, p: separate page)
    \centering % Center the table horizontally
    \caption{RMSE Changes in the Training Process } % Table caption
    \label{tab:example} % Table label for referencing
    \begin{tabular}{|c|c|} % Table columns and alignment (c: centered, l: left-aligned, r: right-aligned)
        \hline % Horizontal line
        Training Round Series Number & RMSE Value \\ % Table header row
        \hline % Horizontal line
        The initial round & 0.2549273084527181 \\ % Table content row 1
        $1^{st}$ round after updating weights & 0.2533034897883127 \\ % Table content row 2
        $2^{nd}$ round after updating weights &  0.25168867193304295 \\ % Table content row 3
        $3^{rd}$ round after updating weights & 0.2500828467539077 \\ % Table content row 3
        $4^{th}$ round after updating weights & 0.24848600471098364 \\ % Table content row 3
        $5^{th}$ round after updating weights & 0.24689813490352622 \\ % Table content row 3
        $6^{th}$ round after updating weights & 0.2453192251151097 \\ % Table content row 3
        $7^{th}$ round after updating weights & 0.24374926185781415 \\ % Table content row 3
        $8^{th}$ round after updating weights & 0.24218823041545254 \\ % Table content row 3
        $9^{th}$ round after updating weights & 0.2406361148858535\\ % Table content row 3
        $10^{th}$ round after updating weights & 0.2390928982221956 \\ % Table content row 3
        Final round when updating stops & 0.015029038262485394 \\ % Table content row 3
        
        
        \hline % Horizontal line
    \end{tabular}
\end{table}

\color{blue}To use neural network with all features provided, we build a ANN model with the following topology: v10,u10 to calculate wind direction at 10 meter as input of $x_1$, wind speed at 10 meter as $x_2$. v100 and u100 to calculate wind direction at 100 meter as input of $x_3$,  wind speed at 100 meter as $x_4$.  
\color{red}{write program of this model , and a paragraph to explan the predicted values vs. actual measurements }
\begin{figure}
\centering
\includegraphics[width=0.8\linewidth]{fig/q41.png}
\caption{\label{fig:q41} \neutral ANN Topology for All Features}
\end{figure}

}


\printbibliography{reference}
\bibitem[1]{https://amt.copernicus.org/articles/15/3465/2022/}


\end{document}

% For Question 1, you should show the ML formulas for each model. 
% For Question 4, yes, you have to use finalize model , need to work with "all features"?
% why the stopping condition is the difference of two RMSE, instead of RMSE below a threshold?